


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.0">
    
    
      
        <title>Reactでサンプルアプリを構築する - Auth0 AppSync React ハンズオン</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.18ac144a.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/notosansjp.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:600,800">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#react" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="Auth0 AppSync React ハンズオン" class="md-header-nav__button md-logo" aria-label="Auth0 AppSync React ハンズオン">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Auth0 AppSync React ハンズオン
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Reactでサンプルアプリを構築する
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Auth0 AppSync React ハンズオン" class="md-nav__button md-logo" aria-label="Auth0 AppSync React ハンズオン">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Auth0 AppSync React ハンズオン
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../setup/cloud9/" title="環境構築" class="md-nav__link">
      環境構築
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      ハンズオン
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="ハンズオン" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        ハンズオン
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Reactでサンプルアプリを構築する
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Reactでサンプルアプリを構築する" class="md-nav__link md-nav__link--active">
      Reactでサンプルアプリを構築する
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-react-app" class="md-nav__link">
    Create React Appを使ってセットアップする
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    プロフィール画面にユーザー情報を表示する
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-react-app" class="md-nav__link">
    Create React Appを使ってセットアップする
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    プロフィール画面にユーザー情報を表示する
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="react">Reactでサンプルアプリを構築する</h1>
<p>作成したAppSyncにを利用するフロントエンドアプリケーションをReactで作成しましょう。</p>
<!-- TODO: Reactに関する簡単な説明 -->

<p>TODO: Reactに関する簡単な説明 Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum</p>
<h2 id="create-react-app">Create React Appを使ってセットアップする</h2>
<p>Create React App（CRA）を使ってアプリケーションを生成します。任意の作業用ディレクトリに移動後、下記のコマンドを実行します。</p>
<div class="codehilite"><pre><span></span><code>npx create-react-app@3.4.1 --template typescript react-appsync-protected-by-auth0
<span class="nb">cd</span> react-appsync-protected-by-auth0
</code></pre></div>


<p>React RouterとAuth0のSPA用SDKをインストールします。</p>
<div class="codehilite"><pre><span></span><code>yarn add react-router-dom@5.1.2 @auth0/auth0-spa-js@1.8.1
yarn add -D @types/react-router-dom@5.1.2
</code></pre></div>


<p>Auth0をReactで利用する為のCustom Hookを作成します。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ./src/react-auth0-spa.tsx</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">createAuth0Client</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">Auth0Client</span><span class="p">,</span> <span class="nx">Auth0ClientOptions</span><span class="p">,</span>
  <span class="nx">getIdTokenClaimsOptions</span><span class="p">,</span> <span class="nx">GetTokenSilentlyOptions</span><span class="p">,</span> <span class="nx">GetTokenWithPopupOptions</span><span class="p">,</span> <span class="nx">IdToken</span><span class="p">,</span> <span class="nx">LogoutOptions</span><span class="p">,</span>
  <span class="nx">PopupConfigOptions</span><span class="p">,</span>
  <span class="nx">PopupLoginOptions</span><span class="p">,</span> <span class="nx">RedirectLoginOptions</span><span class="p">,</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@auth0/auth0-spa-js&#39;</span><span class="p">;</span>

<span class="nx">type</span> <span class="nx">Auth0ContextOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">isAuthenticated</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">user</span>: <span class="kt">any</span><span class="p">;</span>
  <span class="nx">loading</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">popupOpen</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">loginWithPopup</span><span class="o">:</span> <span class="p">(</span><span class="nx">options?</span>: <span class="kt">PopupLoginOptions</span><span class="p">,</span> <span class="nx">config?</span>: <span class="kt">PopupConfigOptions</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nx">handleRedirectCallback</span><span class="o">:</span> <span class="p">(</span><span class="nx">path?</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nx">getIdTokenClaims</span><span class="o">:</span> <span class="p">(</span><span class="nx">options?</span>: <span class="kt">getIdTokenClaimsOptions</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">IdToken</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nx">loginWithRedirect</span><span class="o">:</span> <span class="p">(</span><span class="nx">options?</span>: <span class="kt">RedirectLoginOptions</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nx">getTokenSilently</span><span class="o">:</span> <span class="p">(</span><span class="nx">options?</span>: <span class="kt">GetTokenSilentlyOptions</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nx">getTokenWithPopup</span><span class="o">:</span> <span class="p">(</span><span class="nx">options?</span>: <span class="kt">GetTokenWithPopupOptions</span><span class="p">,</span> <span class="nx">config?</span>: <span class="kt">PopupConfigOptions</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nx">logout</span><span class="o">:</span> <span class="p">(</span><span class="nx">options?</span>: <span class="kt">LogoutOptions</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="nx">type</span> <span class="nx">Auth0ProviderOptions</span> <span class="o">=</span> <span class="nx">Auth0ClientOptions</span> <span class="o">&amp;</span> <span class="p">{</span>
  <span class="nx">children</span>: <span class="kt">React.ReactElement</span><span class="p">;</span>
  <span class="nx">onRedirectCallback</span>: <span class="kt">Auth0ContextOptions</span><span class="p">[</span><span class="s1">&#39;handleRedirectCallback&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">Auth0Context</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">({}</span> <span class="kr">as</span> <span class="nx">Auth0ContextOptions</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">useAuth0</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useContext</span><span class="o">&lt;</span><span class="nx">Auth0ContextOptions</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">Auth0Context</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">Auth0Provider</span>: <span class="kt">React.FC</span><span class="o">&lt;</span><span class="nx">Auth0ProviderOptions</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">children</span><span class="p">,</span>
    <span class="nx">onRedirectCallback</span><span class="p">,</span>
    <span class="p">...</span><span class="nx">initOptions</span>
  <span class="p">}</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">isAuthenticated</span><span class="p">,</span> <span class="nx">setIsAuthenticated</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">user</span><span class="p">,</span> <span class="nx">setUser</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">auth0Client</span><span class="p">,</span> <span class="nx">setAuth0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="o">&lt;</span><span class="nx">Auth0Client</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">popupOpen</span><span class="p">,</span> <span class="nx">setPopupOpen</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

  <span class="nx">React</span><span class="p">.</span><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">initAuth0</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">auth0FromHook</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">createAuth0Client</span><span class="p">(</span><span class="nx">initOptions</span><span class="p">);</span>
      <span class="nx">setAuth0</span><span class="p">(</span><span class="nx">auth0FromHook</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;code=&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;state=&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span><span class="nx">appState</span><span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">auth0FromHook</span><span class="p">.</span><span class="nx">handleRedirectCallback</span><span class="p">();</span>
        <span class="nx">await</span> <span class="nx">onRedirectCallback</span><span class="p">(</span><span class="nx">appState</span><span class="o">?</span><span class="p">.</span><span class="nx">targetUrl</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kr">const</span> <span class="nx">isAuthenticated</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">auth0FromHook</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">();</span>

      <span class="nx">setIsAuthenticated</span><span class="p">(</span><span class="nx">isAuthenticated</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">auth0FromHook</span><span class="p">.</span><span class="nx">getUser</span><span class="p">();</span>
        <span class="nx">setUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">initAuth0</span><span class="p">();</span>
    <span class="c1">// eslint-disable-next-line</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="kr">const</span> <span class="nx">loginWithPopup</span>: <span class="kt">Auth0ContextOptions</span><span class="p">[</span><span class="s1">&#39;loginWithPopup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setPopupOpen</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">await</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">loginWithPopup</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
      <span class="nx">setPopupOpen</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">getUser</span><span class="p">();</span>
    <span class="nx">setUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="nx">setIsAuthenticated</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="kr">const</span> <span class="nx">handleRedirectCallback</span>: <span class="kt">Auth0ContextOptions</span><span class="p">[</span><span class="s1">&#39;handleRedirectCallback&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">await</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">handleRedirectCallback</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">getUser</span><span class="p">();</span>
    <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="nx">setIsAuthenticated</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">setUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">Auth0Context</span><span class="p">.</span><span class="nx">Provider</span>
      <span class="nx">value</span><span class="o">=</span><span class="p">{{</span>
        <span class="nx">isAuthenticated</span><span class="p">,</span>
        <span class="nx">user</span><span class="p">,</span>
        <span class="nx">loading</span><span class="p">,</span>
        <span class="nx">popupOpen</span><span class="p">,</span>
        <span class="nx">loginWithPopup</span><span class="p">,</span>
        <span class="nx">handleRedirectCallback</span><span class="p">,</span>
        <span class="nx">getIdTokenClaims</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">getIdTokenClaims</span><span class="p">(</span><span class="nx">options</span><span class="p">),</span>
        <span class="nx">loginWithRedirect</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">loginWithRedirect</span><span class="p">(</span><span class="nx">options</span><span class="p">),</span>
        <span class="nx">getTokenSilently</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">getTokenSilently</span><span class="p">(</span><span class="nx">options</span><span class="p">),</span>
        <span class="nx">getTokenWithPopup</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">getTokenWithPopup</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">config</span><span class="p">),</span>
        <span class="nx">logout</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">auth0Client</span><span class="o">!</span><span class="p">.</span><span class="nx">logout</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
      <span class="p">}}</span>
    <span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="err">/Auth0Context.Provider&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div>


<p>ログイン／ログアウト操作を行わせる為にNavBarを作成します。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ./src/components/NavBar.tsx</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">useAuth0</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../react-auth0-spa&quot;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">NavBar</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">isAuthenticated</span><span class="p">,</span> <span class="nx">loginWithRedirect</span><span class="p">,</span> <span class="nx">logout</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useAuth0</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="o">!</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">loginWithRedirect</span><span class="p">({})}</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="k">in</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
      <span class="p">)}</span>

      <span class="p">{</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">logout</span><span class="p">()}</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="nx">out</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div>


<p>historyを生成し、どこからでもアクセスが出来るようにします。
TODO: この部分の説明が怪しい
useHistory() Hookを使わずに、createBrowserHistory()を使っているのは、前者はRouteコンポーネント配下でしか使えないが、後者はどこでも使える（少なくともpushの定義は出来る）からです。</p>
<div class="codehilite"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">createBrowserHistory</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;history&quot;</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="nx">createBrowserHistory</span><span class="p">();</span>
</code></pre></div>


<p>Auth0の設定をアプリケーションが取り込めるようにJSON形式で保存します。先程作成した、Auth0のApplication定義のSettingsタブからDomainとClient IDを転記してください。
今回はサンプルアプリケーションなので、環境（dev/stg/prd）差分を考慮せずパラメーターをハードコートしています。</p>
<p><img alt="" src="../img/auth0-get-domain-and-client-id.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="err">#</span> <span class="err">./src/auth-config.json</span>
<span class="p">{</span>
  <span class="nt">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_DOMAIN&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientId&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_ID&quot;</span>
<span class="p">}</span>
</code></pre></div>


<p>作成したAuth0 Custom Hookをアプリケーションに結合させる為に、<code>index.tsx</code>を編集します。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ./src/index.tsx</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./App&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">serviceWorker</span> <span class="nx">from</span> <span class="s1">&#39;./serviceWorker&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">history</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./utils/history&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Auth0Provider</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./react-auth0-spa&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">config</span> <span class="nx">from</span> <span class="s2">&quot;./auth_config.json&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">onRedirectCallback</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">url?</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">url</span> <span class="o">??</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">React</span><span class="p">.</span><span class="nx">StrictMode</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Auth0Provider</span>
      <span class="nx">domain</span><span class="o">=</span><span class="p">{</span><span class="nx">config</span><span class="p">.</span><span class="nx">domain</span><span class="p">}</span>
      <span class="nx">client_id</span><span class="o">=</span><span class="p">{</span><span class="nx">config</span><span class="p">.</span><span class="nx">clientId</span><span class="p">}</span>
      <span class="nx">redirect_uri</span><span class="o">=</span><span class="p">{</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span><span class="p">}</span>
      <span class="nx">onRedirectCallback</span><span class="o">=</span><span class="p">{</span><span class="nx">onRedirectCallback</span><span class="p">}</span>
    <span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">App</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/Auth0Provider&gt;</span>
  <span class="o">&lt;</span><span class="err">/React.StrictMode&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// If you want your app to work offline and load faster, you can change</span>
<span class="c1">// unregister() to register() below. Note this comes with some pitfalls.</span>
<span class="c1">// Learn more about service workers: https://bit.ly/CRA-PWA</span>
<span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">unregister</span><span class="p">();</span>
</code></pre></div>


<p>CRAで生成されたCSS等使わないので削除してしまいましょう。</p>
<ul>
<li>logo.svg</li>
<li>index.tsx</li>
<li>index.css</li>
<li>App.css</li>
<li>App.test.tsx</li>
</ul>
<p>アプリケーションを実行して、ログインが出来るか確認します。</p>
<p>まず、テスト用のユーザーをAuth0に作成します。Auth0のDashbordを開き、<strong>Users &amp; Roles</strong>、<strong>Users</strong>とメニューを選択し、<strong>CREATE USER</strong>を選択します。</p>
<p><img alt="" src="../img/auth0-list-users.png" /></p>
<p>ユーザーのEmailとPasswordを入力し、<strong>CREATE</strong>を選択します。</p>
<p><img alt="" src="../img/auth0-create-user.png" /></p>
<p>ベリファイのメールが届くのでリンクをクリックして、ユーザーを使用可能な状態に遷移させます。</p>
<p><img alt="" src="../img/auth0-verify-mail.png" /></p>
<p>ユーザーの準備ができたので、アプリケーションを実行しログインが行えるか確認します。下記のコマンドで実行すると、デフォルトブラウザで <a href="http://loclahost:3000">http://loclahost:3000</a> が開きます。自動でブラウザが開かない場合は手動でURLを入力してアクセスしてください。</p>
<div class="codehilite"><pre><span></span><code>yarn start
</code></pre></div>


<p>ブラウザで素朴な画面が表示されるので、Log inボタンを選択します。</p>
<p><img alt="" src="../img/app-login.png" /></p>
<p>Auth0のユニバーサルログイン画面にリダイレクトされるので、テストユーザーのEmailとPasswordを入力し、<strong>LOG IN</strong>を選択します。</p>
<p><img alt="" src="../img/auth0-universal-login.png" /></p>
<p>アプリケーションに対する認可を確認されるのでチェックアイコンを選択します。アプリケーションにアイコンを設定していないので、画像が表示されていませんね。</p>
<p><img alt="" src="../img/auth0-universal-login-authorize.png" /></p>
<p>一瞬、<strong>Loading...</strong>と表示された後に、<strong>Log out</strong>ボタンだけの素朴な画面に戻れば成功です。</p>
<p><strong>Log out</strong>を選択してログアウトしておきます。以降もアプリケーションを編集する前にはログアウトしてから行います。特に後ほど<strong>audience</strong>を設定する際には事前にログアウトが必須です。</p>
<p><img alt="" src="../img/app-logout.png" /></p>
<h2 id="_1">プロフィール画面にユーザー情報を表示する</h2>
<p><strong>Token</strong>の情報を表示するプロフィール画面を作成します。<strong>Token</strong>から情報を表示するのでログイン済みである必要があります。これに対応する為に、ログインしていなければAuth0のユニバーサルログイン画面へリダイレクトするPrivate Routeコンポーネントを作成します。</p>
<p>プロフィール画面を作成します。Auth0 Custom Hookからユーザー情報を取得し、表示します。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ./src/components/Profile.tsx</span>
<span class="kr">import</span> <span class="nx">React</span>  <span class="nx">from</span> <span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">useAuth0</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../react-auth0-spa&quot;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">Profile</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">loading</span><span class="p">,</span> <span class="nx">user</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useAuth0</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span> <span class="o">||</span> <span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Loading</span><span class="p">...</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">picture</span><span class="p">}</span> <span class="nx">alt</span><span class="o">=</span><span class="s2">&quot;Profile&quot;</span> <span class="o">/&gt;</span>

      <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
      <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
      <span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span><span class="o">&lt;</span><span class="err">/code&gt;</span>
    <span class="o">&lt;</span><span class="err">/&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div>


<p><code>NavBar.tsx</code>を変更し、Profile画面に移動できるようにします。</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">components</span><span class="o">/</span><span class="n">NavBar</span><span class="o">.</span><span class="n">tsx</span>
<span class="kn">import</span> <span class="nn">React</span> <span class="nn">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">useAuth0</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;../react-auth0-spa&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">Link</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="n">export</span> <span class="n">const</span> <span class="n">NavBar</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="n">const</span> <span class="p">{</span><span class="n">isAuthenticated</span><span class="p">,</span> <span class="n">loginWithRedirect</span><span class="p">,</span> <span class="n">logout</span><span class="p">}</span> <span class="o">=</span> <span class="n">useAuth0</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="err">!</span><span class="n">isAuthenticated</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="n">button</span> <span class="n">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="n">loginWithRedirect</span><span class="p">()}</span><span class="o">&gt;</span><span class="n">Log</span> <span class="ow">in</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
      <span class="p">)}</span>
      <span class="p">{</span><span class="n">isAuthenticated</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
        <span class="o">&lt;&gt;</span>
          <span class="o">&lt;</span><span class="n">button</span> <span class="n">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="n">logout</span><span class="p">()}</span><span class="o">&gt;</span><span class="n">Log</span> <span class="n">out</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">Link</span> <span class="n">to</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="n">Home</span><span class="o">&lt;/</span><span class="n">Link</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">Link</span> <span class="n">to</span><span class="o">=</span><span class="s2">&quot;/profile&quot;</span><span class="o">&gt;</span><span class="n">Profile</span><span class="o">&lt;/</span><span class="n">Link</span><span class="o">&gt;</span>
          <span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
        <span class="o">&lt;/&gt;</span>
      <span class="p">)}</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div>


<p><code>App.tsx</code>を変更しProfile画面へのルーティングを定義します。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ./src/App.tsx</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">NavBar</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./components/NavBar&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span><span class="p">,</span> <span class="nx">Route</span><span class="p">,</span> <span class="nx">Switch</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;react-router-dom&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Profile</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./components/Profile&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">history</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./utils/history&quot;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;App&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Router</span> <span class="nx">history</span><span class="o">=</span><span class="p">{</span><span class="nx">history</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">header</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">NavBar</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="err">/header&gt;</span>
        <span class="o">&lt;</span><span class="nx">Switch</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span> <span class="nx">exact</span> <span class="o">/&gt;</span>
          <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/profile&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Profile</span><span class="p">}</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="err">/Switch&gt;</span>
      <span class="o">&lt;</span><span class="err">/Router&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div>


<p>まだ、リダイレクトが設定されていないので、下記のURLへアクセスするとLoading状態のまま遷移しません。</p>
<p><a href="http://localhost:3000/profile">http://localhost:3000/profile</a></p>
<p><img alt="" src="../img/app-loading.png" /></p>
<p>Private Route コンポーネントを作成します。このコンポーネントは React RouterのRouteコンポーネントのWrapperでログインしていなければ、ユニバーサルログイン画面にリダイレクトします。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ./src/components/PrivateRoute.tsx</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Route</span><span class="p">,</span> <span class="nx">RouteProps</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">useAuth0</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../react-auth0-spa&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">PrivateRoute</span>: <span class="kt">React.FC</span><span class="o">&lt;</span><span class="nx">RouteProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">component</span>: <span class="kt">Component</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">loading</span><span class="p">,</span> <span class="nx">isAuthenticated</span><span class="p">,</span> <span class="nx">loginWithRedirect</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useAuth0</span><span class="p">();</span>

  <span class="nx">React</span><span class="p">.</span><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span> <span class="o">||</span> <span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kr">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">await</span> <span class="nx">loginWithRedirect</span><span class="p">({</span>
        <span class="nx">appState</span><span class="o">:</span> <span class="p">{</span><span class="nx">targetUrl</span>: <span class="kt">window.location.pathname</span><span class="p">}</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">fn</span><span class="p">();</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">isAuthenticated</span><span class="p">,</span> <span class="nx">loginWithRedirect</span><span class="p">,</span> <span class="nx">path</span><span class="p">]);</span>

  <span class="kr">const</span> <span class="nx">render</span>: <span class="kt">RouteProps</span><span class="p">[</span><span class="s1">&#39;render&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">props</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span> <span class="nx">Component</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Component</span> <span class="p">{...</span><span class="nx">props</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="p">{</span><span class="nx">path</span><span class="p">}</span> <span class="nx">render</span><span class="o">=</span><span class="p">{</span><span class="nx">render</span><span class="p">}</span> <span class="p">{...</span><span class="nx">rest</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>


<p><code>App.tsx</code>を変更して、Profile画面をPrivate Routeで保護します。</p>
<div class="codehilite"><pre><span></span><code><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">NavBar</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./components/NavBar&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span><span class="p">,</span> <span class="nx">Route</span><span class="p">,</span> <span class="nx">Switch</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;react-router-dom&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Profile</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./components/Profile&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">history</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./utils/history&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">PrivateRoute</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./components/PrivateRoute&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;App&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Router</span> <span class="nx">history</span><span class="o">=</span><span class="p">{</span><span class="nx">history</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">header</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">NavBar</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="err">/header&gt;</span>
        <span class="o">&lt;</span><span class="nx">Switch</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span> <span class="nx">exact</span> <span class="o">/&gt;</span>
          <span class="o">&lt;</span><span class="nx">PrivateRoute</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/profile&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Profile</span><span class="p">}</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="err">/Switch&gt;</span>
      <span class="o">&lt;</span><span class="err">/Router&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div>


<p>アプリケーションを実行して、ログアウト状態でProfile画面にアクセスしようとするとリダイレクトされるか確認します。ログアウトした状態で下記のURLへアクセスします。</p>
<p><a href="http://localhost:3000/profile">http://localhost:3000/profile</a></p>
<p>Auth0のユニバーサルログイン画面へリダイレクトされるので、EmailとPasswordを入力します。</p>
<p>Profile画面が表示されます。表示を確認できたら、ログアウトしておきます。</p>
<p><img alt="" src="../img/app-profile.png" /></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../../setup/cloud9/" title="環境構築" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                環境構築
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>